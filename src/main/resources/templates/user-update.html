<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<meta charset="UTF-8">
<title>Create user</title>
</head>
<body>
    <table>
        <thead>
            <tr class="border-top">
                <th scope="col">ID</th>
                <th scope="col">First name</th>
                <th scope="col">Last name</th>
                <th scope="col">Age</th>
                <th scope="col">E-mail</th>
                <th scope="col">Roles</th>
                <th scope="col">Edit</th>
                <th scope="col">Delete</th>
            </tr>
        </thead>

        <tbody>
            <tr th:each="user : ${users}">
<!--                th:classappend="${rowStat.count % 2 != 0 ? 'table-secondary' : 'table-light'}">-->
                <td th:text="${user.id}"/>
                <td th:text="${user.username}"/>
                <td th:text="${user.lastname}"/>
                <td th:text="${user.age}"/>
                <td th:text="${user.email}"/>
<!--                <td>-->
<!--                    <th:block each="role : ${user.getRoles()}">-->
<!--                        &nbsp;<span text="${role.roles}"/>-->
<!--                    </th:block>-->
<!--                </td>-->
                <td>
                    <a th:href="@{/admin/{id}/profile(id=${user.id})}"
                       class="btn btn-sm btn-info edit-button">Edit</a>
                </td>
                <td>
                    <a th:href="@{/admin/{id}/profile(id=${user.id})}"
                       class="btn btn-sm btn-danger delete-button">Delete</a>
                </td>
            </tr>
        </tbody>
    </table>

<script>
    $(document).ready(function () {
        $('.edit-button').on('click', function (event) {
            event.preventDefault();
            $('#user-profile').modal("show").find('.modal-dialog').load($(this).attr('href'), function(response, status, xhr) {
                if (xhr.status === 404) {
                    $(location).attr('href', '/admin');
                }
                $('#user-profile .modal-header h3').text('Edit User');
                let submit = $('#user-profile .modal-footer .submit');
                submit.text('Save');
                submit.addClass('btn-primary');
                $('#user-profile #method').val("patch");
            });
        });

        $('.delete-button').on('click', function (event) {
            event.preventDefault();
            $('#user-profile').modal("show").find('.modal-dialog').load($(this).attr('href'), function(response, status, xhr) {
                if (xhr.status === 404) {
                    $(location).attr('href', '/admin');
                }
                $('#user-profile .modal-header h3').text('Delete User');
                $('#user-profile #password-div').remove();
                $("#user-profile #firstName").prop("readonly", true);
                $("#user-profile #lastName").prop("readonly", true);
                $("#user-profile #age").prop("readonly", true);
                $("#user-profile #email").prop("readonly", true);
                $("#user-profile #roles").prop("disabled", true);
                let submit = $('#user-profile .modal-footer .submit');
                submit.text('Delete');
                submit.addClass('btn-danger');
                $('#user-profile #method').val("delete");
            });
        });
    });

</script>


</body>
</html>